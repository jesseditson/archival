# A github action for building archival sites and publishing them to a branch.
name: Build & Publish Archival Site
author: "Archival Team"
inputs:
  branch:
    description: "branch to write output to"
    required: false
    default: "archival-dist"
# Allows you to run this workflow manually from the Actions tab
workflow_dispatch:
# Allow only one concurrent deployment, skipping runs queued between the run in-progress and latest queued.
# However, do NOT cancel in-progress runs as we want to allow these production deployments to complete.
concurrency:
  group: "archival"
  cancel-in-progress: false
runs:
  using: composite
  on:
    # Runs on pushes targeting the default branch
    push:
      branches: [$default-branch]
  steps:
    - name: Checkout
      uses: actions/checkout@v4
    - name: Setup Node
      uses: actions/setup-node@v4
    - name: Archival Prebuild
      run: bin/archival prebuild
    - name: Build with Archival
      run: bin/archival build
    - name: Upload artifact
      uses: actions/upload-pages-artifact@v3
      with:
        path: "./$(bin/archival manifest build-dir)"
